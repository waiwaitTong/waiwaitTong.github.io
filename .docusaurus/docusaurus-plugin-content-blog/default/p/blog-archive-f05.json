{"archive":{"blogPosts":[{"id":"/2025/11/10/机器人云台数据接收与控制","metadata":{"permalink":"/blog/2025/11/10/机器人云台数据接收与控制","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-11-10-机器人云台数据接收与控制.md","source":"@site/blog/2025-11-10-机器人云台数据接收与控制.md","title":"机器人云台数据接收与控制","description":"阶段三：CAN电机控制系统（保持不变）","date":"2025-11-10T00:00:00.000Z","tags":[],"readingTime":4.75,"hasTruncateMarker":false,"authors":[],"frontMatter":{},"unlisted":false,"nextItem":{"title":"个人网站搭建.md - 副本","permalink":"/blog/2025/10/31/个人网站搭建.md - 副本"}},"content":"```\n---\ntitle: \"RM\"\nauthors: 歪歪踢\ntags: [blog]\ndate: 2025-11-10\n---\n```\n\n# 任务初步规划（AI辅助）\n\n\n\n阶段三：CAN电机控制系统（保持不变）\n\n3.1 CAN通信配置：波特率 (1Mbps), 过滤器, 发送邮箱。\n\n3.2 CAN通信协议：定义电机ID和数据帧格式（例如，DJI电机的 0x1FF 或 0x200 IDL）。\n\n3.3 控制接口：封装CAN发送函数（例如 CAN\\_Send\\_Motor\\_Current(yaw\\_current, pitch\\_current)）。\n\n阶段四：输入处理与控制器设计（关键优化）\n\n4.1 输入信号处理器（TD）：\n\n目标： 解决“阶跃”输入的“无超调”难题（对应图片“TD补充速度前馈”）。\n\n实现： 在PID之前，加入一个跟踪微分器 (TD) 或斜坡/S型曲线发生器。\n\n输入： 最终目标角度（例如，5°）。\n\n输出： 1.  TD\\_Target\\_Angle(t)：一个平滑的、连续变化的目标角度。\n\n2. TD\\_Target\\_Velocity(t)：平滑目标角度的微分，即速度前馈。\n\n4.2 双环PID控制器结构：\n\n4.2.1 位置环 (外环)：\n\n输入误差： Error = TD\\_Target\\_Angle(t) - IMU\\_Actual\\_Angle。\n\n输出： 目标速度 (Speed Command)。\n\n4.2.2 速度环 (内环)：\n\n输入误差： Error = (Speed Command) - IMU\\_Actual\\_Velocity。\n\n输出： 目标电流 (Current Command)。\n\n4.3 前馈补偿：\n\n最终输出电流 = (速度环PID输出) + (速度前馈 TD\\_Target\\_Velocity(t)) + (重力前馈)。\n\n重力前馈（对应图片5.1 步骤5）：\n\nPitch轴：必须加入重力补偿。\n\n初级实现： + 一个固定的电流值（用于平衡）。\n\n高级实现： + k \\* sin(Pitch\\_Angle)，动态补偿重力力矩。\n\n阶段五：系统集成与任务调度（保持不变）\n\n5.1 实时任务划分：\n\n高频 (1kHz)：IMU读取、PID速度环、CAN发送。\n\n低频 (100-500Hz)：PID位置环、TD计算、状态反馈。\n\n5.2 任务调度：使用TIM定时器中断作为主控制“心跳”。\n\n阶段六：安全保护系统（保持不变）\n\n6.1 通信监测：IMU和CAN的超时检测。\n\n6.2 运行保护：软件角度限位、最大电流限制、堵转保护。\n\n阶段七：调试与性能优化（关键优化）\n\n7.1 建立调试工具（对应图片5.1 步骤4）：\n\n必须： 搭建一个上位机实时波形显示（如VOFA+, 匿名上位机, J-Scope）。\n\n目的： 实时绘制“目标角度”和“IMU反馈角度”两条曲线，这是调试PID和满足KPI的唯一高效方法。\n\n7.2 分步调试流程：\n\n验证IMU数据（波形平稳、角度正确）。\n\n验证CAN通信（电机能响应指令）。\n\n单轴调试：\n\n先只给速度前馈，看运动是否平滑。\n\n再加入速度环PID，整定内环。\n\n最后加入位置环PID，整定外环。\n\n7.3 性能优化：\n\n整定TD的参数（最大速度/加速度），在“快速”和“平稳”间取舍。\n\n整定PID参数，消除振荡和稳态误差。\n\n阶段八：系统联调与验证（关键优化）\n\n8.1 性能达标验证（对应图片5.2）：\n\nYAW轴：在上位机发送 5° 阶跃指令。\n\n指标： 响应时间（达到5°）< 100ms。\n\n指标： 超调量必须 = 0%。\n\nPITCH轴：在上位机发送 2° 阶跃指令。\n\n指标： 响应时间 < 70ms。\n\n指标： 超调量 < 2%。\n\n稳态测试：验证阶跃响应稳定后，无静差（如图中黄框所示）。\n\n大角度测试：YAW轴180°大角度运动，全程平稳无超调。\n\n## 任务实际流程图\n\n```c\n┌───────────────────────────────┐\n│         系统初始化             │\n│ - IMU_SPI1_Init()              │\n│ - BMI088_Init()                │\n│ - UART4_Init_DMA()             │\n│ - Gyro_ZeroCalibrate()         │\n└───────────────┬───────────────┘\n                │\n                ▼\n       ┌─────────────────┐\n       │ 1ms 定时器触发  │\n       │ （1 kHz任务）   │\n       └───────┬─────────┘\n               │\n               ▼\n       ┌───────────────┐\n       │ 云控板任务    │\n       │---------------│\n       │ BMI088_Read() │\n       │  - SPI_Read_Reg() 读取加速度计/陀螺仪原始数据 │\n       │  - 减去零偏 gyro_bias[x/y/z]                │\n       │  - 单位换算 (ax/ay/az → g, gx/gy/gz → °/s) │\n       │  - 互补滤波计算 ROLL/PITCH/YAW             │\n       │     • ROLL/PITCH: α*(角+gyro*dt)+(1-α)*AccelAngle │\n       │     • YAW: 累积 gyro_z*dt                 │\n       │ 填充 IMU_MSG 结构体                          │\n       │ UART4_Send_Packet() DMA发送                  │\n       └───────┬────────────┘\n               │\n               ▼\n       ┌───────────────┐\n       │ 主控板任务    │\n       │---------------│\n       │ DMA接收 USART2 │\n       │  - usart2_rx_buf[32] DMA缓冲区             │\n       │ IMU_Data_Parse()                           │\n       │  - 检查帧尾 0x00 0x00 0x80 0xFF           │\n       │  - memcpy 到 imu_data_rx 结构体           │\n       │ 控制算法或显示使用 imu_data_rx.ROL/PIT/YAW │\n       └───────────────┘\n\n```\n\n# 实操\n\n### 前置知识\n\n#### DMA映射\n\n\n\n\n\n## 任务进度\n\n1. 完成串口初始化 SPI初始化 数据包解码\n\n下一步：阅读手册 了解BMI工作原理 初始化BMI 实现原始数据接收 姿态解算 完成云控接收并向主控发送数据任务\n\n* 完成BMI 串口 SPI初始化 数据处理 零飘标定 姿态解算等基本函数\n\n下一步：理解零飘标定 姿态解算原理 设置任务 实际初始化 帧率检测等 建立接收数据完整认识\n\n* 基本理解上述任务\n\n下一步：创建实际任务 实际初始化 再次总结整合 进行can通信控制电机代码任务 （11.9完成 11.8 9.00下班）\n\n11.9 12.30\n\nkeil添加文件问题 解决方案：使用vscode新建 补充代码 在keil里添加已存在文件即可\n\n* 写云控接收imu任务 不太懂零飘标定和imuread函数中时间参数的意思 调试云控接收数据&#x20;\n\n问题：不会插线。\n\n去做线区找对应插头 看板子原理图 自己做线 成功\n\n问题：收不到数据 BMI初始化未成功\n\n1 引脚不对应 看原理图\n\n2 GPIO CS引脚未初始化&#x20;\n\n3 BMI初始化中读写逻辑不太对\n\n问AI更改后没什么用。。\n\n`acc_id_val` = 0，`gyro_id_val` = 0  读取ID任务判断出SPI通信不正常工作\n\n调试：\n\n1. 写云控发送数据包给主控任务 写主控解析任务\n\n## 教训\n\n一步一调试 不要相信AI 对自己的代码负责 自己的每一行都要明白是什么意思 正确与否"},{"id":"/2025/10/31/个人网站搭建.md - 副本","metadata":{"permalink":"/blog/2025/10/31/个人网站搭建.md - 副本","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-10-31-个人网站搭建.md - 副本.md","source":"@site/blog/2025-10-31-个人网站搭建.md - 副本.md","title":"个人网站搭建.md - 副本","description":"经学长建议决定搭一个个人网站 以记录自己各种  可以避免出现想发表重要意见 但没有具体的发表对象 又不乐意发朋友圈的情况","date":"2025-10-31T00:00:00.000Z","tags":[],"readingTime":2.12,"hasTruncateMarker":false,"authors":[],"frontMatter":{},"unlisted":false,"prevItem":{"title":"机器人云台数据接收与控制","permalink":"/blog/2025/11/10/机器人云台数据接收与控制"}},"content":"```\r\n---\r\ntitle: \"个人网站搭建\"\r\nauthors: 歪歪踢\r\ntags: [blog]\r\ndate: 2025-10-31\r\n---\r\n```\r\n\r\n# 个人网站搭建\r\n\r\n\r\n\r\n# 动机\r\n\r\n经学长建议决定搭一个个人网站 以记录自己各种  可以避免出现想发表重要意见 但没有具体的发表对象 又不乐意发朋友圈的情况\r\n\r\n\r\n\r\n\r\n\r\n# 收获\r\n\r\n1. Markdown使用\r\n\r\n2. AI辅助与认清AI\r\n\r\n# 步骤\r\n\r\n### 环境准备\r\n\r\n1. 生成 SSH 密钥：`ssh-keygen -t rsa -C \"your_email@example.com\"`\r\n\r\n2. 将公钥添加到 GitHub：`cat ~/.ssh/id_rsa.pub`\r\n\r\n3. 配置 SSH 使用 443 端口\r\n\r\n### 项目部署\r\n\r\n```markdown\r\n# 1. 初始化 Git 仓库\r\ngit init\r\ngit add .\r\ngit commit -m \"Initial commit\"\r\n\r\n# 2. 创建 GitHub 仓库（空仓库）\r\n# 3. 设置远程仓库\r\ngit remote add origin git@github.com:waiwaitTong/waiwaitTong.github.io.git\r\ngit push -u origin master\r\n\r\n# 4. 创建 gh-pages 分支\r\ngit checkout --orphan gh-pages\r\necho \"# GitHub Pages\" > README.md\r\ngit add README.md\r\ngit commit -m \"Initial gh-pages\"\r\ngit push origin gh-pages\r\ngit checkout master\r\n\r\n# 5. 确认 baseUrl 配置正确\r\n# 在 docusaurus.config.js 中设置 baseUrl: '/'\r\n\r\n# 6. 部署\r\nyarn deploy\r\n```\r\n\r\n\r\n\r\n\r\n\r\n# 问题及解决方案\r\n\r\n## 环境配置问题\r\n\r\ncmd检测版本号成功 powershell不成功&#x20;\r\n\r\n尝试重装后 开开关关cmd和powershell  再检测又成功\r\n\r\ndeepseek解释说下载前打开终端导致\r\n\r\n那以后多开开关关终端好了\r\n\r\n## 权限问题\r\n\r\n管理员权限运行即可\r\n\r\n或一劳永逸：将code文件夹属性安全改为完全控制\r\n\r\n## 网页不刷新\r\n\r\n并非不刷新\r\n\r\n只是新手初始化教程中选择的页面问题&#x20;\r\n\r\n\r\n\r\n## 网页崩溃\r\n\r\n不知道啥情况 直接重启网站好了\r\n\r\n\r\n\r\n## 编辑后打开巨卡无比\r\n\r\n&#x20;npm run build重启\r\n\r\n## GitHub Pages 部署问题总结\r\n\r\n### 以为成功后网站简陋且丢失blog页面\r\n\r\n似乎是github强制使用自己的网站部署\r\n\r\n使用deepseek和csdn推送的教程均不顶用\r\n\r\n于是选择一切初始化 重新连接仓库开始\r\n\r\nhttps://www.docusaurus.io/docs/deployment#deploying-to-github-pages事实上有官方文档\r\n\r\n可读性不强\r\n\r\n让AI总结了一份\r\n\r\n\r\n\r\n\r\n\r\n### SSH 密钥生成与配置问题\r\n\r\n```c\r\nssh: connect to host github.com port 22: Connection refused\r\n```\r\n\r\n```markdown\r\n# 使用 443 端口测试连接\r\nssh -T -p 443 git@ssh.github.com\r\n\r\n# 创建 SSH 配置文件\r\nmkdir -p ~/.ssh\r\ncat > ~/.ssh/config << 'EOF'\r\nHost github.com\r\n    Hostname ssh.github.com\r\n    Port 443\r\n    User git\r\nEOF\r\n\r\n# 设置文件权限\r\nchmod 600 ~/.ssh/config\r\n```\r\n\r\n# 遗留问题\r\n\r\n1. docker学习使用\r\n\r\n2. 英文阅读\r\n\r\n3. 新手如何利用ai快速入门 且判别ai正确性"}]}}